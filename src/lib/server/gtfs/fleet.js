
const Fleet = {
    "translink": [
        //CMBC
        { "start_range": 3309, "end_range": 3358, "name": "2006 NFI C40LFR", "operator": "CMBC" },
        { "start_range": 7375, "end_range": 7399, "name": "2000 NFI D40LF", "operator": "CMBC" },
        { "start_range": 7401, "end_range": 7429, "name": "2000 NFI D40LF", "operator": "CMBC" },
        { "start_range": 7430, "end_range": 7446, "name": "2001 NFI D40LF", "operator": "CMBC" },
        { "start_range": 7447, "end_range": 7499, "name": "2006 NFI D40LFR", "operator": "CMBC" },
        { "start_range": 7501, "end_range": 7504, "name": "2006 NFI D40LFR", "operator": "CMBC" },
        { "start_range": 8102, "end_range": 8117, "name": "2007 NFI D60LFR", "operator": "CMBC" },
        { "start_range": 8118, "end_range": 8156, "name": "2009 NFI DE60LFR", "operator": "CMBC" },
        { "start_range": 9201, "end_range": 9276, "name": "2000-01 OBI Orion V (05.501)", "operator": "CMBC" },
        { "start_range": 9277, "end_range": 9285, "name": "2007-08 OBI Orion V (05.501)", "operator": "CMBC" },
        { "start_range": 9401, "end_range": 9499, "name": "2009 Nova Bus LFS HEV", "operator": "CMBC" },
        { "start_range": 9501, "end_range": 9542, "name": "2009 Nova Bus LFS HEV", "operator": "CMBC" },
        { "start_range": 9543, "end_range": 9581, "name": "2009 Nova Bus LFS", "operator": "CMBC" },
        { "start_range": 9583, "end_range": 9590, "name": "2009 Nova Bus LFS", "operator": "CMBC" },
        { "start_range": 9605, "end_range": 9699, "name": "2007 Nova Bus LFS", "operator": "CMBC" },
        { "start_range": 9701, "end_range": 9725, "name": "2007 Nova Bus LFS", "operator": "CMBC" },
        { "start_range": 9726, "end_range": 9791, "name": "2008 Nova Bus LFS", "operator": "CMBC" },
        { "start_range": 9797, "end_range": 9799, "name": "2008 Nova Bus LFS", "operator": "CMBC" },
        { "start_range": 12001, "end_range": 12025, "name": "2012-13 NFI XDE60", "operator": "CMBC" },
        { "start_range": 14001, "end_range": 14045, "name": "2014 NFI XN40", "operator": "CMBC" },
        { "start_range": 15001, "end_range": 15021, "name": "2015-16 NFI XDE60", "operator": "CMBC" },
        { "start_range": 16001, "end_range": 16051, "name": "2016-17 NFI XN40", "operator": "CMBC" },
        { "start_range": 16101, "end_range": 16130, "name": "2016 NFI XD40", "operator": "CMBC" },
        { "start_range": 16137, "end_range": 16137, "name": "2016 NFI XD40", "operator": "CMBC" },
        { "start_range": 16201, "end_range": 16226, "name": "2016-17 NFI XDE60", "operator": "CMBC" },
        { "start_range": 18001, "end_range": 18063, "name": "2018-19 NFI XDE60", "operator": "CMBC" },
        { "start_range": 18101, "end_range": 18206, "name": "2018 NFI XN40", "operator": "CMBC" },
        { "start_range": 18301, "end_range": 18404, "name": "2018 Nova Bus LFS HEV", "operator": "CMBC" },
        { "start_range": 18451, "end_range": 18473, "name": "2018 Nova Bus LFS Suburban", "operator": "CMBC" },
        { "start_range": 19001, "end_range": 19047, "name": "2019 NFI XDE60", "operator": "CMBC" },
        { "start_range": 19101, "end_range": 19147, "name": "2019 NFI XN40", "operator": "CMBC" },
        { "start_range": 19301, "end_range": 19302, "name": "2019 Nova Bus LFSe", "operator": "CMBC" },
        { "start_range": 19303, "end_range": 19304, "name": "2019 NFI XE40", "operator": "CMBC" },
        { "start_range": 19401, "end_range": 19432, "name": "2019 Alexander Dennis Enviro500", "operator": "CMBC" },
        { "start_range": 21001, "end_range": 21025, "name": "2021 NFI XDE60", "operator": "CMBC" },
        { "start_range": 21401, "end_range": 21425, "name": "2021 Alexander Dennis Enviro500", "operator": "CMBC" },
        { "start_range": 23201, "end_range": 23215, "name": "2022 Nova Bus LFSe+", "operator": "CMBC" },
        { "start_range": 2101, "end_range": 2101, "name": "2005 NFI E40LF", "operator": "CMBC" },
        { "start_range": 2102, "end_range": 2199, "name": "2006-07 NFI E40LFR", "operator": "CMBC" },
        { "start_range": 2201, "end_range": 2289, "name": "2006-07 NFI E40LFR", "operator": "CMBC" },
        { "start_range": 2501, "end_range": 2540, "name": "2007-08 NFI E60LFR", "operator": "CMBC" },
        { "start_range": 2541, "end_range": 2574, "name": "2009 NFI E60LFR", "operator": "CMBC" },
        { "start_range": 16501, "end_range": 16562, "name": "2016 Girardin G5", "operator": "CMBC" },
        { "start_range": 17506, "end_range": 17564, "name": "2017 Girardin G5", "operator": "CMBC" },
        { "start_range": 18510, "end_range": 18527, "name": "2018 Girardin G5", "operator": "CMBC" },
        { "start_range": 19503, "end_range": 19535, "name": "2019-20 ARBOC SOM 28", "operator": "CMBC" },
        { "start_range": 19538, "end_range": 19549, "name": "2019-20 ARBOC SOM 28", "operator": "CMBC" },
        { "start_range": 19550, "end_range": 19554, "name": "2019 Girardin G5", "operator": "CMBC" },
        { "start_range": 21501, "end_range": 21562, "name": "2020-21 ARBOC SOF 27", "operator": "CMBC" },
    
    
    
        // Blue Bus
    
        { "start_range": 17501, "end_range": 17505, "name": "2017 ARBOC SOM 28", "operator": "Blue Bus" },
        { "start_range": 18501, "end_range": 18509, "name": "2018 ARBOC SOM 28", "operator": "Blue Bus" },
        { "start_range": 19501, "end_range": 19502, "name": "2019-20 ARBOC SOM 28", "operator": "Blue Bus" },
        { "start_range": 19536, "end_range": 19537, "name": "2019-20 ARBOC SOM 28", "operator": "Blue Bus" },
        { "start_range": 701, "end_range": 706, "name": "2007 Nova Bus LFS", "operator": "Blue Bus" },
        { "start_range": 901, "end_range": 909, "name": "2009 Nova Bus LFS", "operator": "Blue Bus" },
        { "start_range": 1201, "end_range": 1217, "name": "2012 NFI XD40", "operator": "Blue Bus" },
        { "start_range": 1601, "end_range": 1605, "name": "2016 NFI XD40", "operator": "Blue Bus" },
        { "start_range": 1606, "end_range": 1614, "name": "2016 NFI XD40", "operator": "Blue Bus" }
    ],
    "bct": [
        { "start_range": 1020, "end_range": 1044, "name": "2013 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1045, "end_range": 1069, "name": "2015 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1070, "end_range": 1114, "name": "2016 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1115, "end_range": 1139, "name": "2017 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1140, "end_range": 1147, "name": "2018 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1148, "end_range": 1185, "name": "2019 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1186, "end_range": 1202, "name": "2020 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1203, "end_range": 1212, "name": "2020 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1213, "end_range": 1232, "name": "2021 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 1233, "end_range": 1253, "name": "2022 New Flyer XN40", "operator": "BC Transit" },
        { "start_range": 4007, "end_range": 4061, "name": "2017 Grande West Vicinity 30'", "operator": "BC Transit" },
        { "start_range": 4062, "end_range": 4070, "name": "2017 Grande West Vicinity 30'", "operator": "BC Transit" },
        { "start_range": 4071, "end_range": 4073, "name": "2018 Grande West Vicinity 30'", "operator": "BC Transit" },
        { "start_range": 4200, "end_range": 4233, "name": "2020 Grande West Vicinity 30' CNG", "operator": "BC Transit" },
        { "start_range": 4234, "end_range": 4248, "name": "2022 VMC Classic Vi30 CNG", "operator": "BC Transit" },
        { "start_range": 4400, "end_range": 4432, "name": "2017 Grande West Vicinity 35'", "operator": "BC Transit" },
        { "start_range": 4433, "end_range": 4474, "name": "2018 Grande West Vicinity 35'", "operator": "BC Transit" },
        { "start_range": 6000, "end_range": 6029, "name": "2017 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9021, "end_range": 9039, "name": "2002 TransBus Trident", "operator": "BC Transit" },
        { "start_range": 9041, "end_range": 9049, "name": "2004 Alexander Dennis Enviro500", "operator": "BC Transit" },
        { "start_range": 9201, "end_range": 9210, "name": "2006 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9211, "end_range": 9231, "name": "2006 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9232, "end_range": 9267, "name": "2007 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9268, "end_range": 9289, "name": "2008 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9290, "end_range": 9300, "name": "2008 Nova Bus LFS Suburban", "operator": "BC Transit" },
        { "start_range": 9301, "end_range": 9318, "name": "2008 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9319, "end_range": 9433, "name": "2009 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9434, "end_range": 9434, "name": "2012 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9435, "end_range": 9446, "name": "2013 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9447, "end_range": 9486, "name": "2015 Nova Bus LFS", "operator": "BC Transit" },
        { "start_range": 9501, "end_range": 9526, "name": "2008 Alexander Dennis Enviro500", "operator": "BC Transit" },
        { "start_range": 9528, "end_range": 9528, "name": "2007 Alexander Dennis Enviro500", "operator": "BC Transit" },
        { "start_range": 9529, "end_range": 9531, "name": "2008 Alexander Dennis Enviro500", "operator": "BC Transit" },
        { "start_range": 9532, "end_range": 9542, "name": "2020 Alexander Dennis Enviro500", "operator": "BC Transit" },
        { "start_range": 9543, "end_range": 9550, "name": "2021 Alexander Dennis Enviro500", "operator": "BC Transit" },
        { "start_range": 2311, "end_range": 2315, "name": "2010 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2316, "end_range": 2339, "name": "2012 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2342, "end_range": 2344, "name": "2012 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2347, "end_range": 2367, "name": "2012 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2369, "end_range": 2377, "name": "2012 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2340, "end_range": 2341, "name": "2011-12 Mercedes-Benz Sprinter MiniBus", "operator": "BC Transit" },
        { "start_range": 2345, "end_range": 2346, "name": "2011-12 Mercedes-Benz Sprinter MiniBus", "operator": "BC Transit" },
        { "start_range": 2368, "end_range": 2368, "name": "2011-12 Mercedes-Benz Sprinter MiniBus", "operator": "BC Transit" },
        { "start_range": 2378, "end_range": 2449, "name": "2013 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2451, "end_range": 2557, "name": "2014 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2558, "end_range": 2618, "name": "2015 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2619, "end_range": 2624, "name": "2015 ARBOC SOM28G", "operator": "BC Transit" },
        { "start_range": 2625, "end_range": 2636, "name": "2016 ARBOC SOM28D", "operator": "BC Transit" },
        { "start_range": 2637, "end_range": 2640, "name": "2016 ARBOC SOM28G", "operator": "BC Transit" },
        { "start_range": 2641, "end_range": 2662, "name": "2017 ARBOC SOM 28", "operator": "BC Transit" },
        { "start_range": 2663, "end_range": 2687, "name": "2018 ARBOC SOM 28", "operator": "BC Transit" },
        { "start_range": 2688, "end_range": 2722, "name": "2020 Girardin Micro Bird G5", "operator": "BC Transit" },
        { "start_range": 2723, "end_range": 2756, "name": "2020 ARBOC SOF 27", "operator": "BC Transit" },
        { "start_range": 2757, "end_range": 2784, "name": "2021 Girardin Micro Bird G5", "operator": "BC Transit" },
        { "start_range": 2785, "end_range": 2801, "name": "2021 Girardin Micro Bird MB-II", "operator": "BC Transit" },
        { "start_range": 3001, "end_range": 3015, "name": "2013 Grande West Vicinity 27.5'", "operator": "BC Transit" }
    ]
};

const LongTermWestVanTransfers = {
    16131: 1608,
    16132: 1613,
    16133: 1614,
    16134: 1610,
    16135: 1611,
    16136: 1612,
    16138: 1609,
    16139: 1606,
    16140: 1607,
}

export const getDisplayBusId = (busId) => {
    if (typeof busId !== "number") throw new TypeError("Type \"" + (typeof busId) + "\" !== \"number\"");


    if (LongTermWestVanTransfers[busId] !== undefined) {
        return LongTermWestVanTransfers[busId];
    }

    // for some reason the 2016 xd40 transfers are ultra random numbers.
    if (busId >= 16600 && busId <= 16699) {
        return busId - 15000;
    }
    if (busId >= 80000 && busId <= 89999) {
        return busId - 80000;
    }

    return busId;
}

export const getBusModelInfo = (busId, systemName) => {
    busId =  typeof busId === "string" ? parseInt(busId) : busId;

    if (systemName.startsWith("bct")) systemName = "bct";
    
    const displayBusId = systemName === "translink" ? getDisplayBusId(busId) : busId;

    for (let vehicles of Fleet[systemName]) {
        if (displayBusId >= vehicles.start_range && displayBusId <= vehicles.end_range) {
            return { name: vehicles.name, operator: vehicles.operator, displayId: displayBusId.toString() };
        }
    }

    console.log("Unknown bus id " + busId + " display id " + displayBusId);
    return { name: "Unknown Model", operator: "Unknown operator", displayId: displayBusId };
}

/**

// GET CMBC - https://cptdb.ca/wiki/index.php/Coast_Mountain_Bus_Company
clear()
let head = document.querySelectorAll(".sortable.jquery-tablesorter")

const bodyConventional = head[0].children[1]
const bodyTrolley = head[2].children[1]
const bodyShuttles  =head[4].children[1]

const bodies = [ bodyConventional, bodyTrolley, bodyShuttles ];

let fleet = [];
for (let body of bodies) {
    for (let node of body.children) {
        let range = node.children[0].firstChild.innerText;
        if (node.children[0].children.length > 1) range += "," + node.children[0].children[2].innerText;
        

        let year = node.children[2].innerText.replaceAll("–", "-");
        if (year.indexOf("-") >= 0) {
            year = year.slice(0, 5) + year.slice(7, 9)
        }
        let childindex = 0;
        if (node.children[3].children.length > 1) childindex = 2;
        let manuf = node.children[3].children[childindex].innerText;
        let model = node.children[4].children[childindex].innerText.replaceAll("\n", " ");
        let separate_ranges = range.replaceAll("–", "-").replace(", ", ",").replace(",\n", ",").replace("\n", ",").split(",")
        for (let r of separate_ranges) {
            if (r.includes("-")) {
                console.log(r)
                let rr = r.split("-");
                fleet.push({ start_range: parseInt(rr[0]), end_range: parseInt(rr[1]), name: `${year} ${manuf} ${model}`, operator: "CMBC" })
            } else {
                fleet.push({ start_range: parseInt(r), end_range: parseInt(r), name: `${year} ${manuf} ${model}`, operator: "CMBC" })
            }
        }
    }
}

console.log(fleet)


// GET BLUE BUS - https://cptdb.ca/wiki/index.php/West_Vancouver_Municipal_Transit
clear()
let head = document.querySelector(".sortable.jquery-tablesorter")

const body = head.children[1]

let fleet = [];
for (let node of body.children) {
    if (node.innerText === "Community Shuttles" || node.innerText === "Conventional Buses") continue;
    let range = node.children[0].firstChild.innerText;
    
    let year = node.children[2].innerText.replaceAll("–", "-");
    if (year.indexOf("-") >= 0) {
        year = year.slice(0, 5) + year.slice(7, 9)
    }
    let childindex = 0;
    if (node.children[3].children.length > 1) childindex = 2;
    let manuf = node.children[3].children[childindex].innerText;
    let model = node.children[4].children[childindex].innerText.replaceAll("\n", " ");
    let separate_ranges = range.replaceAll("–", "-").replace(", ", ",").replace(",\n", ",").replace("\n", ",").split(",")
    for (let r of separate_ranges) {
        if (r.includes("-")) {
            console.log(r)
            let rr = r.split("-");
            fleet.push({ start_range: parseInt(rr[0]), end_range: parseInt(rr[1]), name: `${year} ${manuf} ${model}`, operator: "Blue Bus" })
        } else {
            fleet.push({ start_range: parseInt(r), end_range: parseInt(r), name: `${year} ${manuf} ${model}`, operator: "Blue Bus" })
        }
    }
}


console.log(fleet)


// GET BCTRANSIT - https://cptdb.ca/wiki/index.php/Bc_transit
clear()
let head = document.querySelectorAll(".sortable.jquery-tablesorter")

const bodyConventional = head[0].children[1]
const bodyTrolley = head[0].children[1]
const bodyShuttles  =head[1].children[1]

const bodies = [ bodyConventional, bodyShuttles ];

let fleet = [];
for (let body of bodies) {
    for (let node of body.children) {
        let range = node.children[0].firstChild.innerText;
        if (node.children[0].children.length > 1) range += "," + node.children[0].children[2].innerText;
        

        let year = node.children[2].innerText.replaceAll("–", "-");
        if (year.indexOf("-") >= 0) {
            year = year.slice(0, 5) + year.slice(7, 9)
        }
        let childindex = 0;
        if (node.children[3].children.length > 1) childindex = 2;
        if (node.children[4].children[childindex] === undefined) continue;
        let manuf = node.children[3].children[childindex].innerText;
        
        
        let model = node.children[4].children[childindex].innerText.replaceAll("\n", " ");
        let separate_ranges = range.replaceAll("–", "-").replace(", ", ",").replace(",\n", ",").replace("\n", ",").split(",")
        for (let r of separate_ranges) {
            if (r.includes("-")) {
                console.log(r)
                let rr = r.split("-");
                fleet.push({ start_range: parseInt(rr[0]), end_range: parseInt(rr[1]), name: `${year} ${manuf} ${model}`, operator: "BC Transit" })
            } else {
                fleet.push({ start_range: parseInt(r), end_range: parseInt(r), name: `${year} ${manuf} ${model}`, operator: "BC Transit" })
            }
        }
    }
}

console.log(fleet)

 */